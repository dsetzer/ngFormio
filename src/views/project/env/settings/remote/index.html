<upgrade-warning ng-if="!minPlan('team')" warning="Upgrade your project to a team or commercial plan to enable On-Premise Environments."></upgrade-warning>
<div class="row">
  <div class="col-md-8">
    <div class="remote-env" ng-controller="ProjectRemoteController">
      <div ng-if="!localProject.remote">
        <h2>Connect to an On-Premise Environment</h2>
        <div ng-if="!remoteProjects">
          <div>Enter the information for your on-premise environment to use for this stage.</div>
          <label class="control-label"><strong>Environment URL</strong></label>
          <input type="text" class="form-control" id="serverURL" ng-model="remote.url" placeholder="https://myremoteevironment.com" />
          <p class="text-muted">Use the root url of the environment, not a project url.</p>
          <div class="alert alert-danger" ng-if="insecureWarning">
            <p>Browsers don't allow access to an unsecure resource from a secure page. Either add an SSL Certificate to your environment or switch to the unsecure version of the portal.</p>
            <p><a href="{{unsecurePortal}}" class="btn btn-default">Switch to unsecure portal</a></p>
          </div>
          <label class="control-label"><strong>Portal Secret</strong></label>
          <input type="password" class="form-control" id="portalSecret" ng-model="remote.secret" placeholder="abcdefg123456" />
          <p class="text-muted">The secret key for authentication between the portal and your on-premise environment. Configured in the PORTAL_SECRET environment variable on your server.</p>
          <div class="form-group">
            <label class="control-label"><strong>Project Path Type</strong></label>
            <select class="form-control" ng-options="option as option for option in environmentTypes" ng-model="remote.type" placeholder="Project Paths">
            </select>
            <p class="text-muted">
              Project path type depends on how DNS is set up for your on-premise environment. If you have a wildcard DNS entry for the domain use Subdomain. <br />
              Subdomain is https://myproject.example.com. * Must have wildcard DNS set up on the environment.<br />
              Subdirectory is https://example.com/myproject. <br />
            </p>
          </div>
          <div class="btn btn-primary" ng-class="{'btn-disable': loading}" ng-click="check()">Continue <i ng-if="loading" class="glyphicon glyphicon-refresh glyphicon-spin"></i></div>
          <div ng-if="remoteError" class="text-danger">{{remoteError}}</div>
        </div>
        <div ng-if="remoteProjects">
          <span><strong>Select an existing stage or a new stage:</strong></span>
          <ui-select name="selectProject" class="" ng-model="remote.project" theme="bootstrap">
            <ui-select-match>{{$select.selected.title}} ({{$select.selected.name}})</ui-select-match>
            <ui-select-choices repeat="project in remoteProjects | filter:$select.search">
              {{project.title}} ({{project.name}})
            </ui-select-choices>
          </ui-select>
          <div class="btn btn-primary" ng-class="{'btn-disable': loading}" ng-click="connect()">Connect Stage <i ng-if="loading" class="glyphicon glyphicon-refresh glyphicon-spin"></i></div>
          <div ng-if="remoteError" class="text-danger">{{remoteError}}</div>
        </div>
      </div>
      <div ng-if="localProject.remote">
        <div><strong>On-Premise Environment:</strong></div>
        <div>{{ localProject.remote.url }}</div>
        <div><strong>Stage:</strong></div>
        <div>{{ localProject.remote.project.title}} ({{ localProject.remote.project.name }})</div>
        <div class="btn btn-default" ng-click="disconnect()">Disconnect</div>
      </div>
    </div>
  </div>
  <div class="col-md-4">
    <div class="panel panel-primary">
      <div class="panel-heading">
        <h3 class="panel-title">On-Premise with Environments</h3>
      </div>
      <div class="panel-body">
        <p>On-Premise Environments allow running the form.io server software in your own data center. This allows all forms and submissions to live entirely within your organization's control. This helps with compliance and operational security.</p>
        <p>Each stage of your project can be connected to an environment and versions and deployments will still work between them.</p>
        <p>For more information setting up your environment, see <a target="_blank" href="https://help.form.io/userguide/environments/">On-Premise Environments Help</a>.</p>
        <p>On-Premise Environments are only available on <strong>Team Pro</strong> and <strong>Enterprise</strong> plans.</p>
      </div>
    </div>
  </div>
</div>
